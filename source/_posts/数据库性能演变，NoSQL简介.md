---
title: 数据库性能演变，NoSQL简介
date: 2018/11/26
categories:
- NoSql
---
NoSQL数据库作为时下互联网公司，解决高并发下热点数据读写的可替代方案，绝非三言两语就能讲完，本文从数据库的性能演变，再到NoSQL数据库的特性简单介绍，不堆代码，技术软文，文章最后会附上Redis技术要点脑图，有兴趣的同学可以看看。
<!-- more -->

##### ==*数据库的性能演变*==
* **单机MySQL的美好年代**
> 在90年代，一个网站的访问量一般都不大，用单个数据库完全可以轻松应付。
在那个时候，更多的都是静态网页，动态交互类型的网站不多。
上述架构下，我们来看看数据存储的瓶颈是什么？

 > 1.数据量的总大小 一个机器放不下时

 > 2.数据的索引（B+Tree）一个机器的内存放不下时

 > 3.访问量(读写混合)一个实例不能承受如果满足了上述1 or 3个，进化......

* **Memcached(缓存)+MySQL+垂直拆分**
> 后来，随着访问量的上升，几乎大部分使用MySQL架构的网站在数据库上都开始出现了性能问题，web程序不再仅仅专注在功能上，同时也在追求性能。程序员们开始大量的使用缓存技术来缓解数据库的压力，优化数据库的结构和索引。开始比较流行的是通过文件缓存来缓解数据库压力，但是当访问量继续增大的时候，多台web机器通过文件缓存不能共享，大量的小文件缓存也带来了比较高的IO压力。在这个时候，Memcached就自然的成为一个非常时尚的技术产品。
> Memcached作为一个独立的分布式的缓存服务器，为多个web服务器提供了一个共享的高性能缓存服务，在Memcached服务器上，又发展了根据hash算法来进行多台Memcached缓存服务的扩展，然后又出现了一致性hash来解决增加或减少缓存服务器导致重新hash带来的大量缓存失效的弊端

* **Mysql主从读写分离**
> 由于数据库的写入压力增加，Memcached只能缓解数据库的读取压力。读写集中在一个数据库上让数据库不堪重负，大部分网站开始使用主从复制技术来达到读写分离，以提高读写性能和读库的可扩展性。Mysql的master-slave模式成为这个时候的网站标配了。

* **分表分库+水平拆分+mysql集群**
> 在Memcached的高速缓存，MySQL的主从复制，读写分离的基础之上，这时MySQL主库的写压力开始出现瓶颈，而数据量的持续猛增，由于MyISAM使用表锁，在高并发下会出现严重的锁问题，大量的高并发MySQL应用开始使用InnoDB引擎代替MyISAM。同时，开始流行使用分表分库来缓解写压力和数据增长的扩展问题。这个时候，分表分库成了一个热门技术。也就在这个时候，MySQL推出了还不太稳定的表分区，这也给技术实力一般的公司带来了希望。虽然MySQL推出了MySQL Cluster集群，但性能也不能很好满足互联网的要求，只是在高可靠性上提供了非常大的保证。

* **MySQL的扩展性瓶颈**
> MySQL数据库也经常存储一些大文本字段，导致数据库表非常的大，在做数据库恢复的时候就导致非常的慢，不容易快速恢复数据库。比如1000万4KB大小的文本就接近40GB的大小，如果能把这些数据从MySQL省去，MySQL将变得非常的小。关系数据库很强大，但是它并不能很好的应付所有的应用场景。MySQL的扩展性差（需要复杂的技术来实现），大数据下IO压力大，表结构更改困难，正是当前使用MySQL的开发人员面临的问题。

<br/>

##### ==*基于NoSQL数据库的解决方案*==
* **NoSQL是什么？**
> NoSQL(NoSQL = Not Only SQL )，意即“不仅仅是SQL”，泛指非关系型的数据库。随着互联网web2.0网站的兴起，传统的关系数据库在应付web2.0网站，特别是超大规模和高并发的SNS类型的web2.0纯动态网站已经显得力不从心，暴露了很多难以克服的问题，而非关系型的数据库则由于其本身的特点得到了非常迅速的发展。NoSQL数据库的产生就是为了解决大规模数据集合多重数据种类带来的挑战，尤其是大数据应用难题，包括超大规模数据的存储。
（例如谷歌或Facebook每天为他们的用户收集万亿比特的数据）。这些类型的数据存储不需要固定的模式，无需多余操作就可以横向扩展。

* **NoSQL能干嘛？**

 > 1.==易拓展==:
NoSQL数据库种类繁多，但是一个共同的特点都是去掉关系数据库的关系型特性。数据之间无关系，这样就非常容易扩展。也无形之间，在架构的层面上带来了可扩展的能力。

 > 2.==大数据量下的高性能==
NoSQL数据库都具有非常高的读写性能，尤其在大数据量下，同样表现优秀。(==以redis为例，官方数据 读:11万次/s 写:8万次/s==)，这得益于它的无关系性，数据库的结构简单。一般MySQL使用Query Cache，每次表的更新Cache就失效，是一种大粒度的Cache，在针对web2.0的交互频繁的应用，Cache性能不高。而NoSQL的Cache是记录级的，是一种细粒度的Cache，所以NoSQL在这个层面上来说就要性能高很多了<br/>

 > 3.==多样灵活的数据模型==
NoSQL无需事先为要存储的数据建立字段，随时可以存储自定义的数据格式。而在关系数据库里，增删字段是一件非常麻烦的事情。如果是非常大数据量的表，增加字段简直就是一个噩梦。

 > 4.==传统RDBMS VS NOSQL==

 > RDBMS
 - 高度组织化结构化数据<br/>
 - 结构化查询语言（SQL）<br/>
 - 数据和关系都存储在单独的表中。<br/>
 - 数据操纵语言，数据定义语言<br/>
 - 严格的一致性<br/>
 - 基础事务<br/><br/>

 > NoSQL
 - 代表着不仅仅是SQL<br/>
 - 没有声明性查询语言<br/>
 - 没有预定义的模式<br/>
 - 键值对存储，列存储，文档存储，图形数据库<br/>
 - 最终一致性，而非ACID属性<br/>
 - 非结构化和不可预知的数据<br/>
 - CAP定理<br/>
 - 高性能，高可用性和可伸缩性<br/>

<br/>

##### ==*在分布式数据库中CAP原理CAP+BASE*==

* **CAP是什么?**
 > C：Consistency（强一致性）

 > A：Availability（可用性）

 > P：Partition tolerance（分区容错性）

* **NoSQL经典的CAP图**

 > CAP理论的核心是：一个分布式系统不可能同时很好的满足一致性，可用性和分区容错性这三个需求，
最多只能同时较好的满足两个。
因此，根据 CAP 原理将 NoSQL 数据库分成了满足 CA 原则、满足 CP 原则和满足 AP 原则三 大类：

 > CA-单点集群，满足一致性，可用性的系统，通常在可扩展性上不太强大。

 > CP-满足一致性，分区容忍必的系统，通常性能不是特别高。

 > AP-满足可用性，分区容忍性的系统，通常可能对一致性要求低一些。

* **BASE是什么？**

 > BASE就是为了解决关系数据库强一致性引起的问题而引起的可用性降低而提出的解决方案。
BASE其实是下面三个术语的缩写：

    ==基本可用==（Basically Available）<br/>
    ==软状态==（Soft state）<br/>
    ==最终一致==（Eventually consistent）

 > 它的思想是通过让系统放松对某一时刻数据一致性的要求来换取系统整体伸缩性和性能上改观。为什么这么说呢，缘由就在于大型系统往往由于地域分布和极高性能的要求，不可能采用分布式事务来完成这些指标，要想获得这些指标，我们必须采用另外一种方式来完成，这里BASE就是解决这个问题的办法。

* **分布式+集群简介**

 > 分布式系统（distributed system）

 > 由多台计算机和通信的软件组件通过计算机网络连接（本地网络或广域网）组成。分布式系统是建立在网络之上的软件系统。正是因为软件的特性，所以分布式系统具有高度的内聚性和透明性。因此，网络和分布式系统之间的区别更多的在于高层软件（特别是操作系统），而不是硬件。分布式系统可以应用在在不同的平台上如：Pc、工作站、局域网和广域网上等。

 > 简单来讲：

 > 1、分布式：不同的多台服务器上面部署不同的服务模块（工程），他们之间通过Rpc/Rmi之间通信和调用，对外提供服务和组内协作。

 > 2、集群：不同的多台服务器上面部署相同的服务模块，通过分布式调度软件进行统一的调度，对外提供服务和访问。
 




==redis技术要点脑图下载请移步cf：==
略
